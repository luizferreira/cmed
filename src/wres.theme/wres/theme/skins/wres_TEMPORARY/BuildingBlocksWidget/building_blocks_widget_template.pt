<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:tal="http://xml.zope.org/namespaces/tal"
	  xmlns:metal="http://xml.zope.org/namespaces/metal"
	  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	  i18n:domain="cmfuemr">

  <head><title></title></head>

  <body>

	<metal:view_macro define-macro="view">
	  <tal:define define="refs python:here.getReferenceImpl(field.relationship)"
				  condition="refs">

		<tal:block tal:define="ref python:refs[0];
							   obj ref/getTargetObject">

			<a href="#"
			   tal:attributes="href obj/absolute_url;
							   class python:obj.portal_type.replace(' ', '_')"
			   i18n:translate="" tal:content="python:obj.Title() or obj.absolute_url(relative=1)"
			   >
			  Sole target object's title
			</a>

			<a href="#"
			   tal:condition="python:portal.portal_interface.objectImplements(ref,'Products.Archetypes.interfaces.referenceengine.IContentReference')"
			   tal:attributes="href python:ref.getContentObject().absolute_url();
							   class python:obj.portal_type.replace(' ', '_')"
			   tal:content="field/relationship">
			  reference object link
			</a>

		</tal:block>
	  </tal:define>
	</metal:view_macro>

	<metal:edit_macro define-macro="edit">
	  <metal:use use-macro="field_macro | here/widgets/field/macros/edit">

		<div metal:fill-slot="widget_body"
			 tal:define="special python:field.widget.getSpecialVocabulary(here, field);
						 vocab special/default;
						 fieldName python:fieldName+':list';
						 uids python:same_type(value, []) and value or [value];
						 vlen python:len(vocab);
						 related_field python:None;">

		  <div>
			<select tal:attributes="name fieldName;
									id fieldName;">

				<option value="no_patient" selected="selected">Procure ou Registre um Paciente&nbsp;&nbsp;</option>

			 <tal:item tal:repeat="item vocab">
			  <option selected="selected"
					  tal:define="no_ref python: value is None and item == '';"
					  tal:attributes="value item;
									  selected python:test((item in uids) or no_ref, 'selected', '')"
					  tal:content="python:here.translate(vocab.getMsgId(item), default=vocab.getValue(item))"></option>
			 </tal:item>
			</select>
			<script tal:condition="related_field"
				tal:content="structure python:here.create_js_vocabulary_controller(special, field, related_field)" >
			</script>
			<br />
			<tal:popup_search tal:define="block python:widget.getBlock('popup_search');">
				<metal:render_block use-macro="here/building_blocks_widget_template/macros/popup_search" />
			</tal:popup_search>
			<tal:quick_register tal:define="block python:widget.getBlock('popup_quick_register');">
				<metal:render_block use-macro="here/building_blocks_widget_template/macros/popup_quick_register" />
			</tal:quick_register>
		  </div>
		  <metal:addable metal:use-macro="here/widgets/addable_support/macros/addable"/>
		</div>
	  </metal:use>
	</metal:edit_macro>

	<metal:popup_search_macro define-macro="popup_search">
		<input class="standalone add"
			   type="button"
			   id="popup_search"
			   value=""
			   tal:attributes="value block/value;
			   				   id string:popup_search_${field/getName};
			   				   onclick_template python:widget.popup_search_onclick(context, field, block, template=True);
			   				   onclick python:widget.popup_search_onclick(context, field, block);" />
		<script tal:condition="block/filter_indexes | nothing"
				tal:content="structure python:here.create_popup_js(field, related_field, 'search', 'popup_search_template')">
		</script>
	</metal:popup_search_macro>

	<metal:popup_quick_register_macro define-macro="popup_quick_register">
		<input class="standalone add"
			   type="button"
			   value=""
			   tal:attributes="value block/value;
			   				   id string:popup_quick_register_${field/getName};
			   				   onclick python:widget.quick_register_onclick(context, field);
			   				   onclick_template python:widget.quick_register_onclick(context, field, template=True);" />

		<script tal:condition="block/default_values | nothing"
			tal:content="structure python:context.create_popup_js(field, related_field, 'quick_register', 'popup_quick_register_script')">
		</script>
	</metal:popup_quick_register_macro>

	<metal:search_macro define-macro="search">
	  <div metal:use-macro="here/widgets/reference/macros/edit"></div>
	</metal:search_macro>

  </body>
</html>
