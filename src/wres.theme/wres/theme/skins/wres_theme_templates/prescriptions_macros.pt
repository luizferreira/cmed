<!-- TODO Excluir este template-->

<!--<metal:add_prescription define-macro="add_prescription">-->
    
    <!--tal:print content="template/id" /-->
    <!--form tal:attributes="action template/id;">
        <label> Medicamento: </label>
        <input type="text" id="medication" size="20" />
        <div class="field">
            <input type="submit" class="standalone" name="form.button.add" value="Adicionar">
        </div>
    
    </form-->

    <!--<form 
        tal:define="state options/state | request/state;
                    portal_status_msg state/kwargs/portal_status_message | request/portal_status_message | nothing;
                    errors state/getErrors;
                    error_message errors/error_message | nothing" 
        tal:attributes="action template/id;" 
        method="post">  

        <fieldset class="cmed">
            <legend tal:content="legend | default">Adicionar Prescrição</legend>    -->

            <!-- portal status message -->
<!--            <dl class="portalMessage info"
                tal:condition="portal_status_msg"> 
                <dt> Info </dt>
                <dd tal:content="portal_status_msg"> Prescrição adicionada com sucesso. </dd>
            </dl>
            <dl class="portalMessage error"
                tal:condition="error_message"> 
                <dt> Erro </dt>
                <dd tal:content="error_message"> Ocorreu algum erro. </dd>
            </dl>     -->       

            <!-- exigido pelo CMFController -->
            <input type="hidden" name="form.submitted" value="1" />      

            <!-- campo data inicio (hidden)" -->
            <div class="field">
                <label i18n:translate="cmfuemr_label_date">Data: </label>
                <!--input type="text" id="date" name="shown_start" size="11"
                       tal:define="mask string:dd/dd/dddd"
                       tal:attributes="value request/shown_start | template_data/shown_start | widget/shown_start | nothing"
                /-->
                <!--<input type="text" id="date" name="shown_start" size='11' 
                    maxlength="10" onFocus="javascript:vDateType='3'" 
                    onKeyUp="DateFormat(this,this.value,event,false,'3')" 
                    onBlur="DateFormat(this,this.value,event,true,'3')" 
                    tal:attributes="value request/shown_start | template_data/shown_start | widget/shown_start | nothing" />                
                <input type="hidden" id="hidden_date" name="start"
                       tal:attributes="value request/start | template_data/start | widget/start | nothing" />-->
                <!--script type="text/javascript">
                        document.getElementById('date').focus();
                </script-->
            </div>

            <div style="width:800px">


            <table id="prescription_table_add" class="listing" width="100%" cellpadding="0">
                <thead>
                    <th>Medicamento</th>
                    <th>Concentração</th>
                    <th>Uso</th>
                    <!--th>#</th-->
                    <!--th>Refils</th-->
                </thead>
                <!--<tbody>

                    <!-- coluna medicamento -->
                    <td style="width:40%">
                        <div class="label">
                            <input size="30" type="text" id="medication" name="medication"
                                tal:attributes="value request/medication | 
                                                template_data/medication | nothing" />
                        </div>
                    </td>-->

                    <!-- coluna concentracao -->
                    <!--<td>
                        <div class="mgorsol">
                            <div class="label">
                                <input size="4" type="text" id="mgsol_text" name="mgsol_text"
                                       tal:attributes="value request/mgsol_text |
                                                       template_data/mgsol_text | nothing" />
                            </div>
                            <div class="mgsol">
                                <input type="radio" id="mg" name="mgsol" value="mg"
                                    tal:attributes="checked python:request.get('mgsol', '') == 'mg'" /> <span i18n:translate="cmfuemr_text_mg">mg </span><br/>
                                <input type="radio" id="sol" name="mgsol" value="sol"
                                    tal:attributes="checked python:request.get('mgsol', '') == 'sol'" /> <span i18n:translate="cmfuemr_text_%sol">%sol</span>
                            </div>
                        </div>
                    </td>-->

                    <!-- coluna uso -->
                    <td style="width:40%">
                        <div class="label">
                            <input size="30" type="text" id="sig" name="sig"
                                       tal:attributes="value request/sig | 
                                       template_data/sig | nothing" />
                        </div>
                    </td>          

                    <!-- coluna # -->
                    <!--td>
                        <div class="label">
                            <input size="8" type="text" id="number" name="number"
                                   tal:attributes="value request/number | 
                                   template_data/number | nothing" />
                        </div>
                    </td-->

                    <!-- coluna Refils -->
                    <!--td>
                        <div class="label">
                            <input size="8" type="text" id="refills" name="refills"
                                tal:attributes="value request/refills | 
                                template_data/refills | nothing" />
                        </div>
                    </td-->
                </tbody>                    
            </table>

            <!--div id="end_date_div">
                
                <table class="listing" style="width:110%">

                    <thead>
                        <th class="nosort"> <div class="center">Validade</div> </th>                   
                    </thead>

                    <tbody>
                        <tr>
                        <td> 
                            <div id="first_line">
                                <input type="text" name="delta" id="delta" size="4"
                                    tal:attributes="value request/delta | nothing" />
                                <span style="float:right">
                                <input type="radio" class="date" name="is_what" value="days" id="is_what_days" tal:attributes="checked python:request.get('is_what', '') == 'days';"/>
                                <span>Dias</span>

                                <input type="radio" class="date" name="is_what" value="weeks" id="is_what_weeks"
                                    tal:attributes="checked python:request.get('is_what', '') == 'weeks'" />
                                <span>Semanas</span>

                                <input type="radio" class="date" name="is_what" value="months" id="is_what_months" 
                                    tal:attributes="checked python:request.get('is_what', '') == 'months'" />
                                <span>Meses</span>
                                </span>

                            </div> 
                        </td>
                        </tr>

                        <tr>
                            <td>
                               <div class="center"> ou </div>
                            <td>
                        </tr>

                        <tr>
                            <td> 
                                <div id="second_line" class="center">
                                    <span>Data: </span>
                                    <!--input type="text" id="end_date" name="shown_end" size="11"
                                        tal:define="mask string:dd/dd/dddd"
                                        tal:attributes="value request/shown_end | 
                                        template_data/shown_date | nothing" /->
                                    <input type="text" id="end_date" name="shown_date" size='11' 
                                        maxlength="10" onFocus="javascript:vDateType='3'" 
                                        onKeyUp="DateFormat(this,this.value,event,false,'3')" 
                                        onBlur="DateFormat(this,this.value,event,true,'3')" 
                                        tal:attributes="value request/shown_end | 
                                        template_data/shown_date | nothing" />

                                    <input type="hidden" id="hidden_end_date" name="end"
                                        tal:attributes="value request/end | 
                                        template_data/end | nothing" />
                                </div> 
                            </td> 
                        </tr>                       
                    </tbody>

                </table>

            </div-->                                  

            <span style="float:right">
                <div:buttons metal:define-slot="buttons" style="float:right">
                    <input type="submit" name="form.button.add" id="add_prescription"
                        value="Adicionar Prescrição" />
                    <img id="loadergif" tal:attributes="src string:${portal_url}/ajaxloader.gif;" style="display: none;" />                        
                </div:buttons>

                <!--div style="float:right; background:gray; border:solid black; padding:20px" width="30px" id="add_prescription"> Teste </div-->
            </span>
            <!--input type="text" name="foo" tal:define="val request/foo|nothing" 
            tal:attributes="value val" />       

            <input type="submit" name="form.button.add" value="Adicionar Prescrição" /-->

            </div>
        </fieldset>   

    </form>

</metal:add_prescription>

<metal:show_prescriptions define-macro="show_prescriptions"
    tal:define="readonly readonly | nothing">

    <form>
        <input type="hidden" name="form.submitted" value="1" />
        <fieldset class="cmed">
            <legend tal:content="data/title">Prescrições Correntes</legend>

            <!-- portal status message -->
            <!--dl class="portalMessage error"> 
                <dt> Erro </dt>
                <dd> Ocorreu algum erro. </dd>
            </dl-->

            <dl class="portalMessage error"
                tal:condition="error_message | nothing"> 
                <dt> Erro </dt>
                <dd tal:content="error_message"> Ocorreu algum erro. </dd>
            </dl>       

            <table id="current_prescriptions" class="listing" width="100%">
                <thead>
                    <th></th>
                    <th class="nosort"
                        tal:condition="not:readonly">-</th>
                    <th>Data</th>
                    <!--th>Final</th-->
                    <th>Medicamento</th>
                    <th>Concentração</th>
                    <th>Uso</th>
                    <!--th>#</th-->
                    <!--th>Refils</th-->
                    <!--th>CRM</th-->
                    <!--th>DNS</th-->
                    <th>Criado por</th>
                    <!--th>Assinado por</th-->
                    <th class="nosort"
                        tal:condition="python:state=='current' and not readonly">Ações</th>
                    <th class="nosort"
                        tal:condition="python:state in ('historical', 'innefective')">Razão</th>
                </thead>

                <tbody>
                    <tr tal:repeat="prescription data/prescriptions"
                        tal:attributes="class python:test(repeat['prescription'].number()%2 == 0, 'even', 'odd')">

                        <!-- coluna numero -->
                        <td tal:define="doctor_id prescription/submitted_by;
                                        global doctor_name python:context.getDoctorNameById(doctor_id);"
                            tal:content="python:str(repeat['prescription'].number()).zfill(2)">01</td>

                        <!-- coluna renovacao -->    
                        <td tal:condition="not:readonly">
                            <span tal:condition="prescription/renewed">R</span>
                            <span tal:condition="not:prescription/renewed">
                                <input type="checkbox" name="current:list"
                                    tal:attributes="name string:${prescription/state}:list;
                                                    value prescription/id" />
                            </span>
                        </td>

                        <!-- coluna inicio -->
                        <td tal:content="prescription/start">08/11/2006</td>

                        <!-- coluna fim -->
                        <!--td tal:content="prescription/end">09/11/2006</td-->

                        <!-- coluna medicamento -->
                        <td tal:content="prescription/medication" i18n:translate="">med</td>

                        <!-- coluna concentracao -->
                        <td tal:condition="prescription/mg">
                            <span tal:content="prescription/mg"> 12 </span> mg
                        </td>                        
                        <td tal:condition="prescription/sol">
                            <span tal:content="prescription/sol"> 12 </span> %
                        </td>                                                
                        <!--td tal:define="mg_sol prescription/mg | prescription/sol" 
                            tal:content="mg_sol">12</td-->

                        <!-- coluna uso -->
                        <td tal:content="prescription/sig" i18n:translate="">SIG</td>
                        <!--td tal:content="prescription/number">12</td-->
                        <!--td tal:content="prescription/refills">3</td-->
                        <!--td tal:condition="not:prescription/dont_substitute">No</td-->
                        <!--td tal:condition="prescription/dont_substitute">Yes</td-->
                        <td tal:content="doctor_name">Nome do Medico</td>
                        
                        <!--td tal:define="signer_id prescription/signed_by;
                                        signer_name python:context.getDoctorNameById(signer_id)">
                            <span tal:condition="prescription/signed">
                                  <span tal:content="signer_name" />
                            </span>
                            <span tal:condition="not:prescription/signed">Nao Assinado</span>
                        </td-->
                        
                        <!--td tal:condition="python:state=='current'">
                            <tal:teste content="python:context.portal_membership.getAuthenticatedMember().id"/>
                        </td-->
                        <td tal:condition="python:(state=='current') and not readonly">
                            <input type="button" class="context" value="Editar" name="form.button.edit"
                                tal:attributes="onclick string:javascript:window.location = '${template/id}?form.submitted=1&form.button.edit=edit&prescription_id=${prescription/id}'" />
                        </td>
                        <!--td tal:condition="python:prescription['signed'] and state=='current'">Signed</td-->
                        <td tal:condition="python:(state in ('historical', 'innefective'))"
                            tal:content="prescription/reason">
                            reason
                        </td>
                    </tr>
                </tbody>
                                
            </table>

            <metal:button_slot define-slot="buttons">
                <!--tal:allow_sign condition="template_data/allow_sign | nothing">
                    <input type="submit" class="context" name="form.button.sign" value="Assinar" />
                </tal:allow_sign-->
                <input type="submit" class="context" name="form.button.historical" value="Histórico"/>
                <input type="submit" class="context" name="form.button.innefective" value="Ineficaz"/>
                <!-- Esta funcionalidade precisa ser implementada -->
                <input type="submit" class="context" name="form.button.print" value="Imprimir"/>
            </metal:button_slot>

        </fieldset>

</metal:show_prescriptions>